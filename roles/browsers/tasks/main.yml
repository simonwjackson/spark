--- 
- name: Install
  block: 
    - name: Install | w3m
      pacman:
        name: w3m
        state: present

    - name: Install | Firefox
      pacman:
        name: firefox
        state: present
      tags:
        - firefox

    - name: Install | Chromium
      pacman:
        name: chromium
        state: present
      tags:
        - chromium

- name: Install | scripts
  copy:
    src: "{{ item }}"
    dest: "/usr/local/bin/{{ item | basename | splitext | first }}"
    mode: 0755 
  with_fileglob: 
    - files/bin/*

- name: qutebrowser
  tags:
    - qutebrowser
  block:
    - name: qutebrowser | Install
      aur:
        name: qutebrowser-git
        user: "{{ user.name }}" 

    - name: qutebrowser | Install
      pip:
        name: adblock

    - name: Config | Directory
      file:
        path: /home/{{ user.name }}/.config/qutebrowser
        state: directory 
        owner: "{{ user.name }}"
        group: "{{ user.group }}"

    - name: Config | rc
      copy: 
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        src: rc/qutebrowser
        dest: /home/{{ user.name }}/.config/qutebrowser/config.py

    - name: Config | Directory
      file:
        path: "/usr/share/qutebrowser"
        state: directory 

    - name: Install | userscripts
      copy:
        src: "{{ item }}"
        dest: "/usr/share/qutebrowser/userscripts/{{ item | basename | splitext | first }}"
        mode: 0755 
      with_fileglob: 
        - files/share/qutebrowser/userscripts/* 

# - name: Install brotabs
#   pip:
#     name: brotab
#     state: latest
#   tags:
#     - brotabs

# - name: Push all-tabs script
#   copy:
#     src: all-tabs.sh
#     dest: /usr/local/bin/all-tabs
#     mode: 0755
#   tags:
#     - fzf
#     - alltabs


# - name: Push rofi browser chooser
#   template:
#     src: browser.sh.j2
#     dest: /usr/local/bin/browser
#     mode: 0755
#   tags:
#     - rofi
#     - chooser

# - name: Create local desktop application dir
#   file:
#     path: /usr/local/share/applications
#     state: directory
#   tags:
#     - rofi
#     - chooser

# - name: Push rofi browser chooser desktop file
#   copy:
#     src: browser.desktop
#     dest: /usr/local/share/applications/browser.desktop
#   tags:
#     - rofi
#     - chooser

# - name: Verify mimeapps.list exists
#   file:
#     path: /etc/xdg/mimeapps.list
#     state: touch
#   tags:
#     - rofi
#     - chooser

# - name: Set rofi browser chooser as default application for relevant mimetypes
#   lineinfile:
#     dest: /etc/xdg/mimeapps.list
#     regexp: "{{ item.regexp }}"
#     line: "{{ item.line }}"
#   with_items:
#     - { regexp: '^text/html=', line: 'text/html=browser.desktop' }
#     - { regexp: '^text/xml=', line: 'text/xml=browser.desktop' }
#     - { regexp: '^text/mml=', line: 'text/mml=browser.desktop' }
#     - { regexp: '^application/xhtml\+xml=', line: 'application/xhtml+xml=browser.desktop' }
#     - { regexp: '^application/xml=', line: 'application/xml=browser.desktop' }
#     - { regexp: '^x-scheme-handler/http=', line: 'x-scheme-handler/http=browser.desktop' }
#     - { regexp: '^x-scheme-handler/https=', line: 'x-scheme-handler/https=browser.desktop' }
#   tags:
#     - rofi
#     - chooser

# - name: Install surfraw
#   pacman:
#     name: surfraw
#     state: present
#   tags:
#     - surfraw

# - name: Configure surfraw browser
#   lineinfile:
#     dest: /etc/xdg/surfraw/conf
#     regexp: '^def   SURFRAW_graphical_browser	'
#     line: 'def   SURFRAW_graphical_browser	/usr/local/bin/browser'
#   tags:
#     - surfraw
#     - chooser

# - name: Push surfraw-rofi script
#   copy:
#     src: surfraw-rofi
#     dest: /usr/local/bin/surfraw-rofi
#     mode: 0755
#   tags:
#     - surfraw
#     - rofi
